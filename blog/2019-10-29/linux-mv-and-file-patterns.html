<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="description" content="HectorCorrea.com">
    <meta name="author" content="hector@hectorcorrea.com">

    <title>HectorCorrea.com</title>

    <link rel="shortcut icon" href="/public/favicon.ico" />
    <link rel="apple-touch-icon" href="/public/favicon.png"/>

    <!-- Styles from https://newcss.net/ -->
    <link rel="stylesheet" href="https://fonts.xz.style/serve/inter.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@exampledev/new.css@1.1.2/new.css">

    <link rel="me" href="https://mastodon.social/@hectorjcorrea" />
    <link rel="canonical" href="https://hectorcorrea.com" />

    <style>
      img {
        padding: 5px;
        box-shadow: 3px 3px 8px #222;
        margin-right: 10px;
        margin-bottom: 10px;
      }

      footer {
        background: var(--nc-bg-2);
        border-bottom: 1px solid var(--nc-bg-3);
        padding: 2rem 1.5rem;

        margin: -2rem calc(0px - (50vw - 50%)) 2rem;

        padding-left: calc(50vw - 50%);
        padding-right: calc(50vw - 50%);

        margin-top: -0px;
        margin-bottom: 0px;
        padding-top: 6px;
        padding-bottom: 6px;
        color: gray;
        font-size: x-small;
      }

      .header-link {
        /* Main body text, see new.css */
        color: var(--nc-tx-2);
        text-decoration: none;
      }

      .nav-link-selected {
        font-weight: bold;
      }

      .socialLogo {
        padding: 0px;
        box-shadow: none;
        margin-right: 0px;
        margin-bottom: 0px;
        width: 16px;
      }
    </style>
  </head>
  <body>
    <header>
      <h1><a class="header-link" href="/">Hector Correa</a></h1>
      <nav style="float:right;">
        <a id="about-menu" href="/about" role="button" class="btn btn-secondary btn-sm">About</a>
        / <a id="presentations-menu" href="/presentations" role="button" class="btn btn-secondary btn-sm">Presentations</a>
        / <a id="blog-menu" href="/blog" role="button" class="btn btn-secondary btn-sm">Blog</a>
      </nav>
    </header>

    <div class="container">
      <h1>Linux mv and file patterns</h1>
<p>Last week I ran into an interesting issue renaming a bunch of files in my machine. The command I ran was:</p>

<pre>
$ mv &#42;.jpeg &#42;.jpg
</pre>

<p>I was expecting this command to rename all <code>.jpeg</code> files to <code>.jpg</code> but instead the command returned</p>

<pre>
$ mv &#42;.jpeg &#42;.jpg
usage: mv [-f | -i | -n] [-v] source target
       mv [-f | -i | -n] [-v] source ... directory
</pre>

<p>At first I thought I had a typo in my command but the reality is that this is not a valid <code>mv</code> command.</p>

<p>The culprit is that my shell (Bash) is expanding <code>&#42;.jpeg</code> and <code>&#42;.jpg</code> <i>before</i> executing the <code>mv</code> command and understandably <code>mv</code> refuses to continue. To illustrate this let's assume there are two <code>.jpeg</code> files and no <code>.jpg</code> files on my machine, when I execute my original command what Bash passes to <code>mv</code> is something like this:</p>

<pre>
$ mv file1.jpeg file2.jpeg &#42;.jpg
</pre>

<p>Notice that Bash expanded <code>&#42;.jpeg</code> into the two individual files and  <code>&#42;.jpg</code> stayed as-is since there is nothing to expand it into. Certainly not what I was intending to do. A few searches on the web showed many people having this same problem, here is <a href="https://unix.stackexchange.com/questions/181141/rename-multiple-files-with-mv-to-change-the-extension">one example</a>.</p>

<p>Working around this issue was easy enough. I wrote a quick shell script to do the job:</p>

<pre>
for FILE in &#96;ls -1 &#42;.jpeg&#96;
do
    BASENAME=&#96;basename $FILE .jpeg&#96;
    TARGET=$BASENAME".jpg"
    mv $FILE $TARGET
done
</pre>

<p>I posted about this issue on Twitter and got several suggestions on how to make this script better. The solution provided by <a href="https://twitter.com/borwick/status/1188697953768050689">John Borwick</a> in particular is very neat:</p>

<pre>
for FILE in &#42;.jpeg
do
    TARGET="${FILE%.jpeg}.jpg"
    mv "$FILE" "$TARGET"
done
</pre>

<p>A few other people suggested that I use either <code>rename</code> or <code>mmv</code> to do what I was trying to do. Both of these utilities can be installed easily on Mac or Linux systems.</p>

<p>Using <a href="https://www.cgarbs.de/blog/archives/430-mmv-mass-rename-of-files-and-more!.html">mmv</a> the syntax to rename the files is:</p>

<pre>
$ mmv -n "&#42;.jpeg" "#1.jpg"
</pre>

<p>Using <a href="https://www.putorius.net/rename-command-linux.html">rename</a> the syntax is:</p>

<pre>
$ rename -xa .jpg &#42;.jpeg
</pre>

<p>One of the things that dawned on me while reading the blog post for <a href="https://www.cgarbs.de/blog/archives/430-mmv-mass-rename-of-files-and-more!.html">mmv</a> and the local man pages for <code>rename (1)</code> was that my original command would have worked in DOS, and I was a DOS/Windows user a long time ago. The <code>mmv</code> blog post even says</p>

<blockquote>
Under good old DOS you could rename multiple files by saying<br/>
REN A&#42;.&#42; B&#42;.&#42;<br/>
</blockquote>

<p>but the reason this worked is because DOS had pretty simple shell that didn't support Unix style pathname pattern expansion (glob). The man page for <code>rename (1)</code> on my system even has the following note:</p>

<blockquote>
...<br/>
-g, --glob<br/>
   Glob filename arguments. This is useful if you're using a braindead shell such as cmd.exe which won't expand wildcards on behalf of the user.<br/>
...<br/>
</blockquote>

<p>So that explains why I was so puzzled. I probably did rename files with a command "like this" before, but it must have been 10 years or so ago and in a different operating system :)</p>

<p><b>Note:</b> Beware that <code>rename</code> is a native system function in Linux systems and <code>man rename</code> might give you information about the function <code>rename (2)</code> rather than the program <code>rename (1)</code> if the program is not installed on your machine. See <a href="https://unix.stackexchange.com/questions/3586/what-do-the-numbers-in-a-man-page-mean">also</a>.</p>

    </div>

    <footer>
      License <a rel="license" target="_blank" href="http://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>
    </footer>

    <script type="text/javascript">
      // Redirect legacy blog URLs
      if (window.location.hash.startsWith("#/blog")) {
        window.location = window.location.toString().replace("#/blog/","blog/");
      }

      // Hande this redirect via JavaScript because GitHub pages does not let me
      // handle this via an HTML redirect due to the ".aspx" extension
      if (window.location.pathname === "/blog/The-Mythical-Man-Month.aspx") {
        window.location = "https://hectorcorrea.com/blog/2007-06-28/the-mythical-man-month";
      }

      // Highlight the current menu option
      var highlightMenu = function() {
        var activeOption = null;
        var url = window.location.pathname;
        if (url.startsWith("/blog/")) {
          activeOption = document.getElementById("blog-menu");
        } else if(url == "/about") {
          activeOption = document.getElementById("about-menu");
        } else if(url == "/presentations") {
          activeOption = document.getElementById("presentations-menu");
        }

        if (activeOption != null) {
          activeOption.classList.add("nav-link-selected");
        }
      }

      highlightMenu();
    </script>
  </body>
</html>
