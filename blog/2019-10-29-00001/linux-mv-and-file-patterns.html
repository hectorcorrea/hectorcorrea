<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="description" content="HectorCorrea.com">
    <meta name="author" content="hector@hectorcorrea.com">

    <title>HectorCorrea.com</title>

    <link rel="shortcut icon" href="/public/favicon.ico" />
    <link rel="apple-touch-icon" href="/public/favicon.png"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="me" href="https://mastodon.social/@hectorjcorrea" />
    <link rel="canonical" href="https://hectorcorrea.com" />

    <style>
      header {
        background-color:  #e1ebf7;
        margin-left: 0px;
        height: 50px;
        max-width: unset;
        padding-top: 10px;
        padding-left: 20px;
        padding-right: 20px;
        border-bottom-style: solid;
        border-bottom-width: 2px;
      }

      h1 {
        margin-top: 20px;
      }

      blockquote {
        padding: 10px 20px;
        margin: 0 0 20px;
        border-left: 5px solid #eee;
        font-family: Courier New,Courier,Lucida Sans Typewriter,Lucida Typewriter,monospace;
      }

      img {
        padding: 5px;
        box-shadow: 3px 3px 8px #222;
        margin-right: 10px;
        margin-bottom: 10px;
      }

      /* Overwrite Bootstrap's default */
      code {
        background-color: #f0f1f2;
        color: #0D0D0D; /* gray-ish */
      }

      /* Custom code and terminal styles */
      pre, pre.code {
        margin-left: 20px;
        display: block;
        padding: 9.5px;
        margin: 0 0 10px;
        margin-left: 0px;
        font-size: 13px;
        line-height: 1.428571429;
        color: #333;
        word-break: break-all;
        word-wrap: break-word;
        background-color: #f5f5f5;
        border: 1px solid #ccc;
        border-radius: 4px;
      }

      pre.terminal {
        margin-left: 20px;
        margin-bottom: 20px;
        background-color: #363446;
        color: #DAD681; /* yellow-ish */
        padding-bottom: 10px;
        padding-top: 10px;
        padding-left: 10px;
        padding-right: 50px;
      }

      .socialList {
        list-style: none;
        padding: 5px;
      }

      .socialLogo {
        padding: 0px;
        box-shadow: none;
        margin-right: 0px;
        margin-bottom: 0px;
        width: 16px;
      }

      footer {
        font-weight: lighter;
        font-size: smaller;
        margin-left: 75px;
        padding-right: 75px;
      }
    </style>
  </head>
  <body>
    <header>
      <a href="/">HectorCorrea.com</a>
      <span style="float:right;">
        <a id="about-menu" href="/about" role="button" class="btn btn-secondary btn-sm">About</a>
        <a id="blog-menu" href="/blog" role="button" class="btn btn-secondary btn-sm">Blog</a>
      </span>
    </header>

    <div class="container">
      <h1>Linux mv and file patterns</h1>
<p>Last week I ran into an interesting issue renaming a bunch of files in my machine. The command I ran was:</p>

<pre>
$ mv &#42;.jpeg &#42;.jpg
</pre>

<p>I was expecting this command to rename all <code>.jpeg</code> files to <code>.jpg</code> but instead the command returned</p>

<pre>
$ mv &#42;.jpeg &#42;.jpg
usage: mv [-f | -i | -n] [-v] source target
       mv [-f | -i | -n] [-v] source ... directory
</pre>

<p>At first I thought I had a typo in my command but the reality is that this is not a valid <code>mv</code> command.</p>

<p>The culprit is that my shell (Bash) is expanding <code>&#42;.jpeg</code> and <code>&#42;.jpg</code> <i>before</i> executing the <code>mv</code> command and understandably <code>mv</code> refuses to continue. To illustrate this let's assume there are two <code>.jpeg</code> files and no <code>.jpg</code> files on my machine, when I execute my original command what Bash passes to <code>mv</code> is something like this:</p>

<pre>
$ mv file1.jpeg file2.jpeg &#42;.jpg
</pre>

<p>Notice that Bash expanded <code>&#42;.jpeg</code> into the two individual files and  <code>&#42;.jpg</code> stayed as-is since there is nothing to expand it into. Certainly not what I was intending to do. A few searches on the web showed many people having this same problem, here is <a href="https://unix.stackexchange.com/questions/181141/rename-multiple-files-with-mv-to-change-the-extension">one example</a>.</p>

<p>Working around this issue was easy enough. I wrote a quick shell script to do the job:</p>

<pre>
for FILE in &#96;ls -1 &#42;.jpeg&#96;
do
    BASENAME=&#96;basename $FILE .jpeg&#96;
    TARGET=$BASENAME".jpg"
    mv $FILE $TARGET
done
</pre>

<p>I posted about this issue on Twitter and got several suggestions on how to make this script better. The solution provided by <a href="https://twitter.com/borwick/status/1188697953768050689">John Borwick</a> in particular is very neat:</p>

<pre>
for FILE in &#42;.jpeg
do
    TARGET="${FILE%.jpeg}.jpg"
    mv "$FILE" "$TARGET"
done
</pre>

<p>A few other people suggested that I use either <code>rename</code> or <code>mmv</code> to do what I was trying to do. Both of these utilities can be installed easily on Mac or Linux systems.</p>

<p>Using <a href="https://www.cgarbs.de/blog/archives/430-mmv-mass-rename-of-files-and-more!.html">mmv</a> the syntax to rename the files is:</p>

<pre>
$ mmv -n "&#42;.jpeg" "#1.jpg"
</pre>

<p>Using <a href="https://www.putorius.net/rename-command-linux.html">rename</a> the syntax is:</p>

<pre>
$ rename -xa .jpg &#42;.jpeg
</pre>

<p>One of the things that dawned on me while reading the blog post for <a href="https://www.cgarbs.de/blog/archives/430-mmv-mass-rename-of-files-and-more!.html">mmv</a> and the local man pages for <code>rename (1)</code> was that my original command would have worked in DOS, and I was a DOS/Windows user a long time ago. The <code>mmv</code> blog post even says</p>

<blockquote>
Under good old DOS you could rename multiple files by saying<br/>
REN A&#42;.&#42; B&#42;.&#42;<br/>
</blockquote>

<p>but the reason this worked is because DOS had pretty simple shell that didn't support Unix style pathname pattern expansion (glob). The man page for <code>rename (1)</code> on my system even has the following note:</p>

<blockquote>
...<br/>
-g, --glob<br/>
   Glob filename arguments. This is useful if you're using a braindead shell such as cmd.exe which won't expand wildcards on behalf of the user.<br/>
...<br/>
</blockquote>

<p>So that explains why I was so puzzled. I probably did rename files with a command "like this" before, but it must have been 10 years or so ago and in a different operating system :)</p>

<p><b>Note:</b> Beware that <code>rename</code> is a native system function in Linux systems and <code>man rename</code> might give you information about the function <code>rename (2)</code> rather than the program <code>rename (1)</code> if the program is not installed on your machine. See <a href="https://unix.stackexchange.com/questions/3586/what-do-the-numbers-in-a-man-page-mean">also</a>.</p>

    </div>

    <footer>
      <p>
        <hr>
        License <a rel="license" target="_blank" href="http://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>
      </p>
    </footer>

    <script type="text/javascript">
      // Redirect legacy blog URLs
      if (window.location.hash.startsWith("#/blog")) {
        window.location = window.location.toString().replace("#/blog/","blog/");
      }

      // Highlight the current menu option
      var highlightMenu = function() {
        var about = document.getElementById("about-menu");
        var blog = document.getElementById("blog-menu");
        var url = window.location.pathname;
        if (url.startsWith("/blog/")) {
          blog.classList.add("btn-primary");
          blog.classList.remove("btn-secondary");
        } else if(url == "/about") {
          about.classList.add("btn-primary");
          about.classList.remove("btn-secondary");
        }
      }

      highlightMenu();
    </script>
  </body>
</html>
